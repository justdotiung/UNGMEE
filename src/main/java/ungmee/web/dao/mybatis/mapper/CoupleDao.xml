<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="ungmee.web.dao.CoupleDao">
 	<select id="get" resultType="ungmee.web.entity.Couple">
	 	SELECT 
	 		id,  
	 		propose_id proposeId,
		    accepter_id accepterId, 
		    couple_name coupleName,
		    message,
		    lovedate,
		    couple_profile coupleProfile,
		    old_data oldData,
		    ask,
		    read,	  
		    accept 
	    FROM couple WHERE id = #{param1}
 	</select>

 	<select id="getUser" resultType="ungmee.web.entity.Couple">
	 	SELECT 
	 		id,  
	 		propose_id proposeId,
		    accepter_id accepterId, 
		    couple_name coupleName,
		    message,
		    lovedate,
		    couple_profile coupleProfile,
		    old_data oldData,
		    ask,
		    read,
		    accept 
	    FROM couple WHERE propose_id = #{id} and old_data = 1
 		UNION
	 	SELECT 
			id,  
	 		propose_id proposeId,
		    accepter_id accepterId, 
		    couple_name coupleName,
		    message,
		    lovedate,
		    couple_profile coupleProfile,
		    old_data oldData,
		    ask,
		    read,
		    accept 
		 FROM couple where accepter_id = #{id} and old_data = 1
 	</select>
 
 	<insert id="insert" parameterType="ungmee.web.entity.Couple">
 		INSERT INTO couple
 		(
		    	PROPOSE_ID, ACCEPTER_ID, 
		    	couple_name,	message, lovedate
		)
		VALUES
		(	#{proposeId}, #{accepterId},	
				#{coupleName}, #{message}, #{loveDate}
		)
 	</insert>
 	
 	<delete id="delete">
		delete couple where propose_id = #{proposeId}
 	</delete>
 	
 	<update id="update" parameterType="ungmee.web.entity.Couple">
	 	UPDATE 
	 		couple
		SET
		    couple_name = #{coupleName},
	    <if test="message != null">
		    message = #{message},
	    </if>
      	<if test="coupleProfile != null">
		    couple_profile = #{coupleProfile} ,
		</if>
		    old_data = #{oldData},
		    read = #{read},
	     <if test="accept != null">
		    accept = #{accept}   
	    </if>
		WHERE
			id= #{id}
 	</update>
 	
 	<select id="getProposeList" resultType="ungmee.web.entity.Couple">
 		SELECT 
 		  id,
	  	  propose_id proposeId,
	      accepter_id accepterId,
	      couple_name coupleName,
	      message,
	      lovedate,
	      couple_profile coupleProfile,
	      old_data oldData,
	      ask,
	      read,
	      accept 
 		FROM COUPLE WHERE accepter_id = #{param1}
 		<if test="param2 lt 2">
 			AND read = #{param2}
 		</if>	
 	
 	</select>
 	
 	<select id="getNewProposeCount" resultType="int">
 		SElECT COUNT(ID) count FROM COUPLE where accepter_id = #{id}
 		 and read= 0
 	</select>
 	
 	
 	
 </mapper>