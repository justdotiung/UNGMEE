<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="ungmee.web.dao.CoupleDao">
 	<select id="get" resultType="ungmee.web.entity.Couple">
	 	SELECT 
	 		id,  
	 		propose_id proposeId,
		    accepter_id accepterId, 
		    name,
		    message,
		    lovedate,
		    profile,
		    old_data oldData,
		    ask,
		    read,	  
		    accept,
		    pseudo 
	    FROM couple WHERE id = #{id}
 	</select>

 	<select id="getUser" resultType="ungmee.web.entity.Couple">
	 	SELECT 
 			id,  
	 		propose_id proposeId,
		    accepter_id accepterId, 
		    name,
		    message,
		    lovedate,
		    profile,
		    old_data oldData,
		    ask,
		    read,	  
		    accept,
		    pseudo
	    FROM couple WHERE propose_id = #{id} and old_data = 1
 		UNION
	 	SELECT 
			id,  
	 		propose_id proposeId,
		    accepter_id accepterId, 
		    name,
		    message,
		    lovedate,
		    profile,
		    old_data oldData,
		    ask,
		    read,	  
		    accept,
		    pseudo
		 FROM couple where accepter_id = #{id} and old_data = 1
 	</select>
 
 	<select id="getSender" resultType="ungmee.web.entity.Couple">
	 	SELECT 
	 		id,  
	 		propose_id proposeId,
		    accepter_id accepterId, 
		    name,
		    message,
		    lovedate,
		    profile,
		    old_data oldData,
		    ask,
		    read,	  
		    accept,
		    pseudo
	    FROM couple WHERE propose_id = #{id} and accept = 0
 	</select>
 	
 	<insert id="insert" parameterType="ungmee.web.entity.Couple">
 		INSERT INTO couple
 		(
		    	PROPOSE_ID, ACCEPTER_ID, 
		    	couple_name,	message, lovedate
		)
		VALUES
		(	#{proposeId}, #{accepterId},	
				#{coupleName}, #{message}, #{loveDate}
		)
 	</insert>
 
 	<update id="update" parameterType="ungmee.web.entity.Couple">
	 	UPDATE 
	 		couple
		SET
		    name = #{name},
	    <if test="message != null">
		    message = #{message},
	    </if>
      	<if test="profile != null">
		    profile = #{profile} ,
		</if>
		    old_data = #{oldData},
		    read = #{read},
		    accept = #{accept}   
		WHERE
			id= #{id}
 	</update>
 	
 	<select id="getProposeList" resultType="ungmee.web.entity.Couple">
 		SELECT 
 			id,  
	 		propose_id proposeId,
		    accepter_id accepterId, 
		    name,
		    message,
		    lovedate,
		    profile,
		    old_data oldData,
		    ask,
		    read,	  
		    accept,
		    pseudo
 		FROM COUPLE WHERE accepter_id = #{param1} 
 		<if test="param2 lt 2">
 			AND read = #{param2}
 		</if>	
 		AND pseudo = 0
 	</select>
 	
 	<select id="getNewProposeCount" resultType="int">
 		SElECT COUNT(ID) count FROM COUPLE where accepter_id = #{id}
 		 and read= 0
 	</select>
 	
 	<delete id="delete">
 		delete from couple where id= #{coupleId}
 	</delete>

 </mapper>